<div data-controller="material-selection"
     data-action="turbo:frame-load->material-selection#setupCheckboxes">

  <div class="card mb-3">
    <div class="card-header bg-light">
      <h5 class="card-title mb-0">現在選択中の問題</h5>
    </div>
    <div class="card-body" data-material-selection-target="selectedList">
      <div class="text-muted">問題を選択してください</div>
    </div>
  </div>

  <div class="table-responsive">
  <table class="table table-hover">
    <thead class="table-light">
      <tr>
        <th style="width: 50px;">選択</th>
        <th style="width: 100px;">問題画像</th>
        <th>タイトル</th>
        <th>タグ</th>
        <th>作成日</th>
      </tr>
    </thead>
    <tbody>
      <% available_materials.each do |material| %>
        <tr>
          <td>
            <div class="form-check">
              <%= check_box_tag "teaching_material_ids[]",
                  material.id,
                  homework.teaching_materials.include?(material),
                  id: "material_#{material.id}",
                  class: "form-check-input",
                  form: "homework_form",
                  data: {
                    material_selection_target: "checkbox",
                    action: "material-selection#handleChange"
                  } %>
            </div>
          </td>
          <td>
            <% if material.question_image.attached? %>
              <%= image_tag(material.question_image,
                          class: "img-thumbnail",
                          style: "max-height: 50px; cursor: pointer;",
                          loading: "lazy",
                          data: {
                            action: "click->image-modal#show",
                            full_url: url_for(material.question_image)
                          }) %>
            <% end %>
          </td>
          <td>
            <label for="material_<%= material.id %>" class="form-check-label">
              <%= material.title %>
            </label>
          </td>
          <td>
            <% material.tags.each do |tag| %>
              <span class="badge bg-secondary" role="button"
                    data-turbo-frame="materials_list"
                    onclick="window.location.href='<%= new_homework_path(tag_id: tag.id, search: params[:search]) %>'">
                <%= tag.name %>
              </span>
            <% end %>
          </td>
          <td><%= l material.created_at, format: :short %></td>
        </tr>
      <% end %>
    </tbody>
  </table>
</div>

<div class="d-flex justify-content-between align-items-center">
  <div class="form-text">※ チェックした順番で問題が表示されます</div>
  <div>
    <%= paginate available_materials %>
  </div>
</div>